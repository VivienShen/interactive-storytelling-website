<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="../js/scene5.js"></script>
    <title>Scene5 - Barrier Reef</title>
    <link rel="stylesheet" href="../styles/scene5-coral.css">
</head>
<body>
    <div id="loading">
        <img id="loading-image" src="../assets/images/scene5/coral/ajax-loader.gif" alt="Loading..." />
    </div>
    <audio autoplay loop id="bg-music">
        <source src="../assets/audio/bgm/Mountain_-_JVNA.mp3" type="audio/mpeg" />
    </audio>
    
    <Section class="sec1">
        <img class= "imageBG" src="../assets/images/scene5/coral/coral-bg.jpg">
        
        <img class="image1" src="../assets/images/scene5/coral/clouds-back.png">
        <img class="image2" src="../assets/images/scene5/coral/clouds-front.png">
        <img class="image3" src="../assets/images/scene5/coral/clouds-3.png">
        <img class="image4" src="../assets/images/scene5/coral/clouds-4.png">
        <img class="image5" src="../assets/images/scene5/coral/hills.png">
        <img class="image6" src="../assets/images/scene5/coral/water-bg.png">
        <img class="image7" src="../assets/images/scene5/coral/boat-02.png">
        <img class="image8" src="../assets/images/scene5/coral/water2.png">
        <img class="image9" src="../assets/images/scene5/coral/water3.png">

        <!--SCROLL DOWN INDICATOR-->
        <div class="scroll-indicator">
            <div class="scroll"></div>
            <p class="scroll-text">Scroll Down</p>
        </div>

    </Section>
    
    <Section class="sec2" onclick=" clickToClose()">

        <img class= "imageBG2" src="../assets/images/scene5/coral/waterFront.jpg">
    
            <img class="image14" src="../assets/images/scene5/coral/fish_back-02.png">
            <img class="image15" src="../assets/images/scene5/coral/fish_midlle-02.png">
            <img class="image16" src="../assets/images/scene5/coral/fish_front-02.png">
            <img class="image17" src="../assets/images/scene5/coral/bubbles-02.png">

            <img class="image-coral" src="../assets/images/scene5/coral/coral2.png">
            
            <svg id="path"  viewBox="-25 170 786 400">
                <path id="motionPath" d="M -112 108 C 61 260 165 339 166 339 C 166 339 400 550 650 500 " fill="none" stroke="#5dba4700" stroke-width="2"/>
            </svg>
            <img class="image13 " src="../assets/images/scene5/coral/turtle.png">
    
            <img class="image18" src="../assets/images/scene5/coral/fish.png">
    
            <svg id="path2"  viewBox="5 180 786 400">
                <path id="motionPath2" d="M 938 66 C 700 250 600 350 550 400 C 450 500 200 600 150 550" fill="none" stroke="#5dba4700" stroke-width="2"/>
            </svg>
            <img class="image19 " src="../assets/images/scene5/coral/fish2.png">
    
            <img class="image11" src="../assets/images/scene5/coral/humans.png">

            <div class="facts">

            </div>
    </Section>

    <div class="indicator" id = "indicator1" onclick="toggleFactBoxes('fact1');"></div>
    <div class="indicator" id = "indicator2" onclick="toggleFactBoxes('fact2');"></div>
    <div class="indicator" id = "indicator3" onclick="toggleFactBoxes('fact3');"></div>

    <p id="fact1" class="factBox fact" style="display: none;">Climate change is a great threat to sea turtles. The sea level rising and the 
        stronger storms will destroy their beach habitats. Warming oceans also change ocean currents which 
        introduces the sea turtles to new predators and harms the coral reef that they need to survive.
        <a href="https://climate.nasa.gov/news/2879/climate-change-puts-pressure-on-sea-turtles/#:~:text=Now%2C%20climate%20change%20is%20exposing,of%20them%20need%20to%20survive." target="_blank">   
            Read more</a>
    </p>

    <p id="fact2" class="factBox fact" style="display: none;">Many fishes depend on corals for their food and habitat, while corals depend 
        on fishes to feed on them for them to continue reproducing and remove some diseases. Increased ocean temperatures from climate change 
        will affect the behavior of coral reef fishes.
        <a href="https://eatlas.org.au/content/relationship-between-corals-and-fishes-great-barrier-reef#:~:text=There%20are%20strong%20mutual%20dependencies,may%20be%20mitigated%20by%20fishes" target="_blank">
            Read more
        </a>
    </p>

    <p id="fact3" class="factBox fact" style="display: none;">The coral reef can help manage global warming since they are essential 
        to controlling carbon dioxide levels in the ocean. However, increased greenhouse gasses from human activity results in 
        ocean acidification which destroys the corals.
        <a href="https://blogpatagonia.australis.com/10-fun-facts-about-coral-reefs/" target="_blank">
            Read more
        </a>
    </p>

    <div class="cam_container">
        <img class="camera-capture" style="display: none;" id="cam" onclick="" onmousedown="camClicked()" onmouseup="camReleased()" src="../assets/images/scene5/cam-capture.png">
    </div>

    <iframe class="reef-counter" title='Rise in sea levels (cm)' src='https://www.theworldcounts.com/embed/challenges/68?background_color=white&color=black&font_family=%22Helvetica+Neue%22%2C+Arial%2C+sans-serif&font_size=14' style='border: none' height='100' width='300'></iframe>
    
    <div class="inventory">
        <img id="inventory-bg" src="../assets/images/scene5/inventory.png" alt="inventory box">
        <div class="icons">
            <img id="camera-icon" class="icon" src="../assets/images/scene5/icon-cam.png" alt="camera item" style="display: block;" onclick="">
            <img id="map-icon" class="icon" src="../assets/images/scene5/icon-map.png" alt="map item" style="display: block;" onclick="window.location.href='scene5.html'">
            <img id="teleport-icon" class="icon" src="../assets/images/scene5/icon.png" alt="teleport button" style="display: block;">
        </div>
    </div>
    
    <div class="text">
            <div id="box1" class="speechbox" style="display:none;">
                <p><b>Robin:</b> The great barrier reef, home to an estimated 25% of all known marine life. Are you ready to dive in? 
                </p>
            </div>
            <div id="box2" class="speechbox" style="display:none;">
                <p><b>Aeryn:</b> Yes I am!</p>
            </div>
    </div>
    
        <!-- <div class="text" >
            <div id="box2" class="speechbox" style="display:none;">
                <p><b>Aeryn:</b> Yes I am!</p>
            </div>
        </div> -->
    
        <!-- <div id="nextBtn" class="trans-btn" onclick="switchTb()" style="display:none;"></div> -->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/MotionPathPlugin.min.js"></script>
        <script src="../js/jquery-3.6.0.min.js" type="text/javascript"></script>
    
        <script>
    
            $(window).on('load', function () {
                $('#loading').hide();
            }) 
                    
            const tl = gsap.timeline({
            scrollTrigger: {
                trigger: '.sec1',
                scrub: 2,
                start: 'top top',
                end: '+=2500',
                pin: true,
                // markers: true
            }
        });

        tl.to(".image1", 2,{
            y: "-100%",
            pin: true,
            duration: 2
        },'start')
        .to(".image2", 4, {
            y: "-100%",
            pin: true,
        },'start')
        .to(".image3", 6, {
            y: "-100%",
            pin: true
        },'start')
        .to(".image4", 8, {
            y: "-100%",
            pin: true
        },'start')
        .to(".image5", 10, {
            y: "-100%",
            pin: true
        }, 'start')
        .to(".image6", 11, {
            y: "-100%",
            pin: true
        }, 'start')
        .to(".image7", 20,  {
            y: "-100%",
            pin: true
        }, 'start')
        .to(".scroll-indicator", {
            opacity: 0,
            duration: 2
        },'start')
        .to("#box1", 2, {
            display: "block",
            pin: true
        }, 'showtext')
        .to("#box2", 2, {
            display: "block",
            pin: true
        }, 'showtext')
        .to(".image8", 22, {
            y: "-100%",
            pin: true
        }, 'start')
        .to(".image9", 26, {
            y: "-100%",
            pin: true
        }, 'start')
        .to(".trans-btn",{
            display: "none",
            pin: true
        },'disappear')
        .to("#box1",{
            display: "none",
            pin: true
        },'disappear')
        .to("#box2",{
            display: "none",
            pin: true
        },'disappear')


        const tl2 = gsap.timeline({
            scrollTrigger: {
                trigger: '.sec2',
                scrub: 1,
                start: 'top top',
                end: 'bottom -50%',
                //pin: true,
                // markers: true
            }
        });

        tl2.to(".image11", {
            y: "290%", 
            scrub: 2,
            duration: 10
        }, 'start')

        .to(".image14", 2, {
            y: "-20%",
            duration: 40
        },'start')
        .to(".image15", 3,{
            y: "-20%",
            duration: 40
        },'start')
        .to(".image16", 4,{
            y: "-20%",
            duration: 40
        }, 'start')
        .to(".image17", 5,{
            y: "-20%",
            duration: 40
        }, 'start')

        const tl3 = gsap.timeline({
            scrollTrigger: {
                trigger: '.image19',
                scrub: 1,
                start: 'top 30%',
                end: '+1200',
                // markers: true
            }
        }, 'start');

        tl3.to(".image19", {
            motionPath: {
                path: "#motionPath2",
                align: "#motionPath2",
                alignOrigin: [0.5, 0.2],
                autoRotate: -150,
            },
            duration: 40
            
        }, 'start')
        .to(".image13", {
            motionPath: {
                path: "#motionPath",
                align: "#motionPath",
                alignOrigin: [0.5, 0.2],
                autoRotate: -40,
            },
            duration: 50
            
        }, 'start')
        .to(".image18", {
            x: "2300px",
            pin: true,
            scrub: 2,
            duration: 80
            
        }, '-=60')
        
        document.getElementById("bg-music").volume = 0.05;

        function switchTb() {  
            let box1 = document.getElementById('box1');
            let box2 = document.getElementById('box2');
            let btn1 = document.getElementById('nextBtn');

            box1.style.display = "none";
            btn1.style.display = "none";
            box2.style.display = "block";
        }

        function openFact(fact) {
            if(document.getElementById(fact).style.display=='block'){
                document.getElementById(fact).style.display='none';
            }else{
                document.getElementById(fact).style.display='block';
            }
        }

        //Retrieving changed name from local storage
        var inputVal = localStorage.getItem("newName");
        console.log(inputVal);

        var all = document.querySelectorAll('.speechbox');

        all.forEach(x => x.textContent = x.textContent.replace(/Aeryn/gi, inputVal));

        //MINI CAMERA GAME
        let root = document.documentElement;

        root.addEventListener("mousemove", e => {
            root.style.setProperty('--mouse-x', e.clientX - 573 + "px");
            root.style.setProperty('--mouse-y', e.clientY - 310 + "px");
        });

        var camera = document.getElementById("cam");

        function openCam() {
            if(camera.style.display=='block'){
                camera.style.display='none';
            }else{
                camera.style.display='block';
            }
        }

        var polarBear = document.getElementById("big-pb");
        let isCaptured = false;

        // var div = document.getElementById('photo');
        // var div2 = div.cloneNode(true);

        function camClicked(){
            camera.style.transform = "scale(0.45, 0.45)";

            //Check if camera overlaps object
            
            var rect2 = camera.getBoundingClientRect();
            var rect1 = polarBear.getBoundingClientRect();

            console.log(rect2);
            console.log(rect1);

            if (!
                (rect1.top > rect2.bottom ||
                rect1.right < rect2.left ||
                rect1.bottom < rect2.top ||
                rect1.left > rect2.right)
            ){
                isCaptured = true;
                console.log("overlapping");
                document.getElementById("game-txt").innerHTML = "Captured";
            
            }else{
                isCaptured = false;
                document.getElementById("game-txt").innerHTML = "Not Captured";
            }

            // Take Screenshot

            // Use the html2canvas function to take a screenshot and append it to the output div
            
            // html2canvas(div).then(
            //     function (canvas) {
            //         document
            //         .getElementById('output')
            //         .appendChild(canvas);
            //     })

            // document.getElementById('output').appendChild(div2);

            // div2.style.width = "100%";
            // div2.style.height = "100%";
            // div2.style.marginTop = "-100%";
            // div2.style.objectFit = "cover";
            // div2.style.overflow = "hidden";
            // div2.style.zIndex = 3;

            console.log(isCaptured);
            
        };


        function camReleased(){
            camera.style.transform= "scale(0.5, 0.5)";
            
        }

        var $window = $(window);
        var cam = document.getElementById("camera-icon");

        $(window).on('scroll', function() {
            $topOffset = $(this).scrollTop();

            console.log($topOffset);

            //Make Camera Glow At end of scroll
            if($topOffset > 5300){
                cam.id = "icon-glow";
                cam.setAttribute('onclick','openCam()');
            }else{
                cam.id = "camera-icon";
                cam.setAttribute('onclick','');
            }

        });

        //OPEN FACTS
        function toggleFactBoxes(fact) {
            
            var x = document.getElementById(fact);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }

            if(fact == "fact1"){
                document.getElementById("fact2").style.display = "none";
                document.getElementById("fact3").style.display = "none";
                console.log("fact1 clicked");
            }
            else if(fact == "fact2"){
                document.getElementById("fact1").style.display = "none";
                document.getElementById("fact3").style.display = "none";
            }
            else{
                document.getElementById("fact1").style.display = "none";
                document.getElementById("fact2").style.display = "none";
            }

            console.log("fact opened");
        }

        function clickToClose(){
            document.getElementById("fact1").style.display = "none";
            document.getElementById("fact2").style.display = "none";
            document.getElementById("fact3").style.display = "none";
        }

    </script>
    </body>
    </html>